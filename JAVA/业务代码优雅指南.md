# 业务层代码条件判断编写

![image-20240624162849640](https://bobbo.oss-cn-beijing.aliyuncs.com/img_for_typora/image-20240624162849640.png)

我们编写通常判断的是反向条件（不是业务流程向下箭头的） 比如说 校验验证码不一致，这样可以避免if语句嵌套越套越深，代码更加优雅

当用户不存在的时候，需要创建新用户，还跟主干流程需要执行相同保存用户到session  这样的话 需要创建新用户的时候返回user 后续使用

```java
public Result login(LoginFormDTO loginForm, HttpSession session) {
        // 1.校验手机号（发送验证码不是已经校验了吗，为啥还要校验？  这是因为是两次不同的请求 有可能会删除原来的手机号重新输入一个错误的，为了代码的健壮性保证）
        String phone = loginForm.getPhone();
        if (RegexUtils.isPhoneInvalid(phone)) {
            // 2.如果不符合，返回错误信息
            return Result.fail("手机号格式错误！");
        }
        // 3.校验验证码
        Object cacheCode = session.getAttribute("code");
        String code = loginForm.getCode();
        if (cacheCode == null || !cacheCode.toString().equals(code)) {
            //3.不一致，报错
            return Result.fail("验证码错误");
        }
        //一致，根据手机号查询用户
        User user = query().eq("phone", phone).one(); //用到mp的查询 第一次见到query

        //5.判断用户是否存在
        if (user == null) {
            //不存在，则创建
            user = createUserWithPhone(phone);
        }
        //7.保存用户信息到session中
        session.setAttribute("user", user);

        return Result.ok();
    }
```

